# 가시면 결정 (컬링)

## 1. 가시면 결정방법의 개념

### 가시면 결정

3차원 물체를 2차원 디스플레이 창에 투영하면 z축 정보는 없어짐

가시면 결정: 관찰자에게 보이는 표면을 식별하는 기준

#### 가시면 결정 알고리즘의 유형

- 이미지 공간 기법: 투영 평면의 각 픽셀 위치에 대해 점 대 점 단위로 가시성을 결정
- 객체 공간 기법: 3차원 공간에 존재하는 객체들의 공간적 순서에 따라 가시면과 은면을 판별함

### 후면 제거(back-face culling)

- 후면이 관찰자를 향하고 있는 다각형을 렌더링 대상에서 제거하는 처리
- 가시면 결정을 위해 검사해야 하는 면의 수가 감소함

#### 다각형에서 전면과 후면의 식별

- 다각형을 정의하는 꼭짓점을 나열하는 순서에 의해 결정(CCW, CW) 

1. 다각형의 법선 벡터를 이용하여 식별: C>0이면 전면 -> 외적, z축 성분만 구해도 됨
1. 다각형의 면적을 이용하여 식별: area > 0 이면 전면, 신발끈 공식 이용 -> 외적

## 2. 이미지 공간 기법

### 깊이 버퍼 알고리즘

- 이미지 공간에서 가시면을 결정하는 대표적 알고리즘
- 투영 평면의 각 위치에서 장면 내의 표면에 대한 깊이 값을 비교하는 방법(z값이 크면 생략)
- 2개의 버퍼를 사용(색상을 저장하는 프레임 버퍼, 깊이 값을 저장하는 깊이 버퍼)
- 깊이는 뷰잉 좌표 시스템의 z축 값에 해당되므로 z-버퍼 기법이라고도 함

### A-버퍼

각 픽셀당 깊이 정보 외에 여러 가지 표면 데이터를 저장하는 버퍼(antialiased, area-averaged, accumulation buffer)

- 깊이 필드: 0 이상(하나의 표면만 투영된 경우) 또는 음(여러 개의 표면이 투영 된 경우)의 실수 저장
- 표면 데이터 필드
    - 깊이 필드 값이 0 이상인 경우: 표면 ID, 색상, 투명도, 픽셀 점유도 등의 표면 정보 저장
    - 깊이 필드 값이 음인 경우: 투영되는 표면들의 정보를 저장하는 노드 리스트의 포인터 저장

### 주사선 알고리즘

- 행 단위로 가시성 검사를 수행하는 가시면 결정 알고리즘
- 주사선 단위로 활동선분목록을 만들어 홀-짝 규칙 적용
    - On 상태의 다각형이 없으면 배경색을 프레임버퍼에 저장
    - 배경 상태에서 On된 다각형은 가시면임
    - On인 다각형이 있는 상태에서 다른 다각형이 On 되면 z-좌표를 비교하여 가시면 결정
    - 가시면인 다각형이 Off상태로 바뀌면 현재 On상태인 다각형 중 z-좌표를 비교하여 가시면 결정
- 문제점: 교차하는 다각형의 처리가 올바르게 되지 않음: 다각형을 분할하여 처리해야 함

## 3. 객체 공간 기법

### 객체 공간 기법이란

화가의 알고리즘: 배경색을 칠한 후 먼 곳의 물체부터 색을 덮어 씌워 그림

### 깊이 정렬 기법

- 깊이 값의 내림차순으로 표면을 정렬
- 가장 큰 깊이 값을 갖는 표면부터 차례로 주사변환
- 깊이 중첩이 있을 경우 재정렬이 필요할 수 있음

### 깊이 중첩이 없는 경우

- 가장 큰 깊이를 갖는 S1의 z축 좌표 최솟값이 다른 표면의 z축 좌표 최대값보다 큰 경우 -> 재정렬 필요 없음
- 가장 큰 깊이를 갖는 S1과 깊이 중첩이 발생한 각 표면이 다음 네 조건을 모두 만족하지 않으면 순서를 바꿈
    1. x-y좌표상에서 두 표면의 경계 직사각형이 서로 중첩하지 않음
    2. s1이 중첩된 표면 s2의 뒤에 위치함
    3. s2가 s1의 앞에 위치함
    4. s1과 s2를 투영 평면에 투영한 결과가 중첩되지 않음
